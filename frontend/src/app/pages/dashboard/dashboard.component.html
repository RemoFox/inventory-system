<div class="container">
  <h2 class="mb-4 m-auto text-center">Dashboard</h2>

  <div *ngIf="Role === 'admin'; else userContent">

    <mat-form-field appearance="fill" class="w-100 mb-4">
      <mat-label> category</mat-label>
      <mat-select [(value)]="selectedCategory" (selectionChange)="onCategoryChange()">
        <mat-option value="All">All</mat-option>
        <mat-option *ngFor="let cat of categories" [value]="cat.name">{{ cat.name }}</mat-option>
      </mat-select>
    </mat-form-field>

  <div class="col-md-4 m-auto pb-5">
  <mat-card>
    <mat-card-title class="text-center">Users count</mat-card-title>
    <mat-card-content>
      <div class="d-flex justify-content-between align-items-center">
        
        <div class="text-start">
          <p class="m-0 text-center">users : {{ usersCount }} </p>
        </div>
        <div style="width: 40px; height: 40px;">
          <canvas baseChart
            [data]="productPieChartData"
            [options]="productPieChartOptions"
            [type]="'doughnut'">
          </canvas>
        </div>

      </div>
    </mat-card-content>
  </mat-card>
</div>
    <div class="row g-3">

<div class="col-md-4">
  <mat-card>
    <mat-card-title class="text-center"> Products count</mat-card-title>
    <mat-card-content>
      <div class="d-flex justify-content-between align-items-center">
        
        <div class="text-start">
          <p class="m-0 text-center">products : {{ totalProducts }} </p>
        </div>
        <!-- Ø§Ù„Ø´Ø§Ø±Øª -->
        <div style="width: 40px; height: 40px;">
          <canvas baseChart
            [data]="productPieChartData"
            [options]="productPieChartOptions"
            [type]="'doughnut'">
          </canvas>
        </div>

      </div>
    </mat-card-content>
  </mat-card>
</div>

<div class="col-md-4">
  <mat-card>
    <mat-card-title class="text-center">  Total Product Quantity </mat-card-title>
    <mat-card-content>
      <div class="d-flex justify-content-between align-items-center">
        <div class="text-start">
          <p class="m-0 text-center">Quantity : {{ totalQuantity }} </p>
        </div>
        <div style="width: 40px; height: 40px;">
          <canvas baseChart
            [data]="productPieChartData"
            [options]="productPieChartOptions"
            [type]="'doughnut'">
          </canvas>
        </div>

      </div>
    </mat-card-content>
  </mat-card>
</div>

<div class="col-md-4">
  <mat-card>
    <mat-card-title class="text-center">  Total Inventory Value</mat-card-title>
    <mat-card-content>
      <div class="d-flex justify-content-between align-items-center">
        
        <div class="text-start">
          <p class="m-0 text-center">  Inventory Value : {{ totalStockValue }} EGP</p>
        </div>
        <div style="width: 40px; height: 40px;">
          <canvas baseChart
            [data]="productPieChartData"
            [options]="productPieChartOptions"
            [type]="'doughnut'">
          </canvas>
        </div>

      </div>
    </mat-card-content>
  </mat-card>
</div>


      <div class="col-md-12 mt-5">
        <h4 class="mt-5 text-center">ðŸ“Š Product Analytics</h4>
        <app-product-chart [labels]="chartLabels" [data]="chartData"></app-product-chart>
      </div>
    </div>
    
  </div>

<ng-template #userContent>
<p>Total Orders : <strong>{{ ordersCount }}</strong></p>

<table mat-table [dataSource]="ordersList" class="mat-elevation-z8  "
style="width: 100%; margin-bottom: 1rem;">

  <ng-container matColumnDef="_id">
    <th mat-header-cell *matHeaderCellDef>  No order</th>
    <td mat-cell *matCellDef="let order"> {{ order._id }} </td>
  </ng-container>

  <ng-container matColumnDef="itemsCount">
    <th mat-header-cell *matHeaderCellDef>   Number of Products </th>
    <td mat-cell *matCellDef="let order"> {{ order.items.length }} </td>
  </ng-container>

  <ng-container matColumnDef="totalAmount">
    <th mat-header-cell *matHeaderCellDef>  total price </th>
    <td mat-cell *matCellDef="let order"> {{ order.totalAmount | currency:'EGP' }} </td>
  </ng-container>

  <ng-container matColumnDef="createdAt">
    <th mat-header-cell *matHeaderCellDef>  order date </th>
    <td mat-cell *matCellDef="let order"> {{ order.createdAt | date:'short' }} </td>
  </ng-container>

  <ng-container matColumnDef="details">
    <th mat-header-cell *matHeaderCellDef> details </th>
    <td mat-cell *matCellDef="let order; let i = index">
      <button mat-raised-button color="primary" (click)="toggleDetails(i); $event.stopPropagation()">
        {{ expandedIndex === i ? ' Hide' : 'Show ' }}
      </button>
    </td>
  </ng-container>

  <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
  <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>

</table>

<div *ngIf="expandedIndex !== null" 
style="background: #f9f9f9; padding: 1rem; border-radius: 6px; margin-top: 1rem;">
  
  <table class="table table-bordered table-striped table-hover shadow text-center">
    <thead class="table-primary">
      <tr>
       <th>Product</th>    
      <th>Price</th>
     <th>Quantity</th>
      <th>Photo</th>  
      </tr>

    </thead>
    <tbody>
      <tr *ngFor="let item of ordersList[expandedIndex].items">
      <td>{{ item.name }}</td><td>{{ item.price | currency:'EGP' }}</td><td>{{ item.quantity }} </td>
      
      
       <td>
      <img *ngIf="item.image" [src]="item.image" width="100" />
    </td>
    </tr>
    </tbody>
    
  </table>
</div>

    
  </ng-template>
  
</div>
